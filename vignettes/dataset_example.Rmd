---
title: "Example of accessing datasets"
author: Loukia M. Spineli
date: "Latest version: `r Sys.Date()`"
source: vignettes/dataset_example.Rmd
output: 
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 3
params:
  EVAL: !r identical(Sys.getenv("NOT_CRAN"), "true")
vignette: >
  %\VignetteIndexEntry{Example of accessing datasets}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  warning = FALSE, 
  message = FALSE,
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, include = FALSE}
library(tracenma)
library(rnmamod)
```

## Introduction

This vignette aims to illustrate the synergy of the **tracenma** package with 
the [**rnmamod**](https://CRAN.R-project.org/package=rnmamod) package to visualise the distribution of each characteristic in the dataset.

## Example on a selected dataset

We will use the dataset that refers to the systematic review of 
[Vestergaard et al., (2007)](https://pubmed.ncbi.nlm.nih.gov/16951908/) 
(PMID is 16951908). We consider the default arguments of the function `get.dataset`:

```{r}
dataset <- get.dataset(pmid = 16951908)
```

The dataset includes three numeric characteristics (`sample.size`, `calcium`, 
`vitamin.D`) and two qualitative characteristics (`sex`, `h.rPTH`). We will present 
the distribution of the characteristics separately for the numeric and qualitative 
ones.

We use the function `distr_characteristics` found in the [**rnmamod**](https://CRAN.R-project.org/package=rnmamod) package to visualise the
distribution of the characteristics. Initially, we drop the columns `arm1`,
and `arm2`, as required by the function, and check the type mode of each
column using the base function`typeof`:

```{r}
# Drop columns arm1 and arm2
new_dataset <- as.data.frame(subset(dataset$Dataset, select = -c(arm1, arm2)))

# Check type mode of all columns
lapply(new_dataset, typeof)
```

The treatment-related columns have to be __characters__ and the columns with the 
qualitative characteristics have to be turned into __integer__ to apply the function `distr_characteristics` (check `?distr_characteristics`):

```{r}
# Turn treatment-related columns into 'character'
new_dataset[, c("treat1", "treat2")] <- lapply(new_dataset[, c("treat1", "treat2")], as.character)

# Turn 'character' into 'integer' for the qualitative characteristics
new_dataset[, c("sex", "h.rPTH")] <- lapply(new_dataset[, c("sex", "h.rPTH")], as.factor)
```

Now we apply the `distr_characteristics` function:

```{r, results = "hide"}
distr_char <- distr_characteristics(input = new_dataset,
                      drug_names = c("control", "PTH 20", "PTH 25", "PTH 32", "PTH 40", "PTH 50" , "PTH 75", "PTH 100", "PTH+ALN"),
                      rename_char = list(c(4:10), c("Sex", "Sample size", "Human (recombinant) parathyroid hormone", "Calcium", "Vitamin D", "Trial duration (months)", "Trial quality")),
                      label_size = 3,
                      title_size = 9.5,
                      axis_title_size = 9.5,
                      axis_text_size = 9.5,
                      axis_x_text_angle = 45,
                      legend_text_size = 9.5)
```

